---
title: Redis 跳跃表
description: 本篇文章将介绍：zskiplistNode、zskiplist 的结构以及存储字段的解释
categories:
 - Redis
---

> 世界以痛吻我，我仍报之以歌。

## 简介
跳跃表（skiplist）是一种有序数据结构，它通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。

## 跳跃表节点 zskiplistNode

```
typedef struct zskiplistNode {
    //层
    struct zskiplistLevel {
    //前进指针
    struct zskiplistNode *forward;
    //跨度
    unsigned int span;
    } level[];
    /后退指针
    struct zskiplistNode *backward;
    //分值
    double score;
    //成员对象
    robj *obj;
} zskiplistNode;
```

**层**

跳跃表节点的 level 数组可以包含多个元素，每个元素都包含一个指向其他节点的指针，程序可以通过这些层来加快访问其他节点的速度，一般来说，层的数量越多，访问其他节点的速度就越快。

每次创建一个新跳跃表节点的时候，程序都根据幂次定律（power law，越大的数出现的概率越小）随机生成一个介于1和32之间的值作为 level 数组的大小，这个大小就是层的“高度”。

**前进指针**

每个层都有一个指向表尾方向的前进指针（level[i].forward 属性），用于从表头向表尾方向访问节点。

**跨度**

层的跨度（level[i].span属性）用于记录两个节点之间的距离：
- 两个节点之间的跨度越大，它们相距得就越远。
- 指向 NULL 的所有前进指针的跨度都为0，因为它们没有连向任何节点。


**后退指针**

节点的后退指针（backward 属性）用于从表尾向表头方向访问节点：跟可以一次跳过多个节点的前进指针不同，因为每个节点只有一个后退指针，所以每次只能后退至前一个节点。

**分值和成员**

节点的分值（score 属性）是一个 double 类型的浮点数，跳跃表中的所有节点都按分值从小到大来排序。

节点的成员对象（obj 属性）是一个指针，它指向一个字符串对象，而字符串对象则保存着一个 SDS 值。

## 跳跃表zskiplist

```
typedef struct zskiplist {
    //表头节点和表尾节点
    structz skiplistNode *header, *tail;
    //表中节点的数量
    unsigned long length;
    //表中层数最大的节点的层数
    int level;
} zskiplist;
```

靠多个跳跃表节点就可以组成一个跳跃表。

通过使用一个 zskiplist 结构来持有这些节点，程序可以更方便地对整个跳跃表进行处理，比如快速访问跳跃表的表头节点和表尾节点，或者快速地获取跳跃表节点的数量（也即是跳跃表的长度）等信息。